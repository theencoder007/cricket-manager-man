<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricketing Manager v1.1</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --glass: rgba(255, 255, 255, 0.1);
            --gold: #fde047;
            --accent: #38bdf8;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white; margin: 0; padding: 0; min-height: 100vh;
        }

        .screen { display: none; padding: 20px; max-width: 600px; margin: auto; padding-bottom: 100px; }
        .active-screen { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--glass); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        
        /* Fixed Team Selection */
        .team-option {
            display: flex; align-items: center; padding: 15px; margin: 10px 0; border-radius: 12px; 
            cursor: pointer; border: 3px solid transparent; transition: 0.2s; background: rgba(255,255,255,0.05);
        }
        .team-option:hover { background: rgba(255,255,255,0.1); }
        .team-option.selected { border-color: var(--gold); background: rgba(255, 255, 255, 0.2); transform: scale(1.02); }
        .team-logo { width: 45px; height: 45px; margin-right: 15px; pointer-events: none; }
        .team-info { pointer-events: none; }

        .btn-main { width: 100%; padding: 15px; background: var(--accent); border: none; border-radius: 10px; font-weight: 900; color: #000; cursor: pointer; }
        .btn-main:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Navigation */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: #0f172a;
            display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid var(--glass);
        }
        .nav-item { cursor: pointer; color: #64748b; font-size: 0.75rem; font-weight: bold; }
        .nav-item.active { color: var(--accent); }

        /* Match UI */
        .commentary { height: 150px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 10px; margin: 10px 0; border-radius: 8px; font-size: 0.9rem; }
        .control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .action-btn { padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; background: var(--glass); color: white; }
        .action-btn:hover { background: rgba(255,255,255,0.2); }
    </style>
</head>
<body>

    <div id="screen-setup" class="screen active-screen">
        <h1 style="color: var(--gold)">Cricket Manager <span style="font-size: 0.8rem; opacity: 0.6;">v1.1</span></h1>
        <div class="card">
            <label style="display:block; margin-bottom:8px; font-size: 0.9rem;">Manager Name</label>
            <input type="text" id="mgr-name" placeholder="E.g. Coach Virat" style="width:90%; padding:12px; border-radius:8px; border:none; background: #1e293b; color: white;">
        </div>
        
        <h3>Choose Your Team (2025 Season)</h3>
        <div id="team-selector-list"></div>
        
        <button id="launch-btn" class="btn-main" onclick="launchGame()" style="margin-top: 20px;">START CAREER</button>
    </div>

    <div id="screen-home" class="screen">
        <div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">
            <img id="dash-logo" src="" style="width:60px;">
            <div>
                <h2 id="dash-team" style="margin:0"></h2>
                <div style="color:var(--accent); font-size:0.8rem;">Manager: <span id="dash-mgr"></span></div>
            </div>
        </div>

        <div class="card" onclick="startMatchDay()" style="text-align:center; background: linear-gradient(to right, #1e293b, #334155); border: 1px solid var(--gold); cursor: pointer;">
            <h3 style="margin:0; color:var(--gold);">NEXT FIXTURE</h3>
            <p id="next-match-info" style="margin:10px 0 0;">Loading season...</p>
            <small style="opacity:0.6;">Tap to Play Match</small>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div class="card">
                <small style="color:var(--accent)">Points</small>
                <div id="stat-pts" style="font-size:1.5rem; font-weight:bold;">0</div>
            </div>
            <div class="card">
                <small style="color:var(--accent)">Position</small>
                <div id="stat-rank" style="font-size:1.5rem; font-weight:bold;">#10</div>
            </div>
        </div>
    </div>

    <div id="screen-match" class="screen">
        <div class="card">
            <div style="display:flex; justify-content:space-between; font-weight:bold;">
                <span id="m-team1">USER</span>
                <span id="m-team2">OPP</span>
            </div>
            <div style="text-align:center; margin:15px 0;">
                <h1 id="m-score" style="font-size:3rem; margin:0;">0/0</h1>
                <div id="m-overs" style="color:var(--accent)">0.0 / 20 Overs</div>
            </div>
            
            <div class="commentary" id="m-log">Ready for the toss...</div>

            <div class="control-grid" id="match-controls">
                <button class="action-btn" onclick="bowlBall('defensive')">Defensive</button>
                <button class="action-btn" onclick="bowlBall('normal')">Balanced</button>
                <button class="action-btn" onclick="bowlBall('aggressive')">Aggressive</button>
                <button class="action-btn" onclick="bowlBall('risky')">Attack!</button>
            </div>
        </div>
    </div>

    <div id="screen-league" class="screen">
        <h3>2025 Standings</h3>
        <div class="card" style="padding: 10px; font-size: 0.8rem;">
            <table style="width:100%; border-collapse: collapse;">
                <thead style="border-bottom: 1px solid var(--glass);">
                    <tr><th style="text-align:left; padding:8px;">Team</th><th>P</th><th>W</th><th>L</th><th>NRR</th><th>Pts</th></tr>
                </thead>
                <tbody id="league-body"></tbody>
            </table>
        </div>
    </div>

    <nav class="bottom-nav" id="game-nav" style="display:none;">
        <div class="nav-item active" onclick="showScreen('screen-home')">DASHBOARD</div>
        <div class="nav-item" onclick="showScreen('screen-league')">TABLE</div>
        <div class="nav-item" onclick="alert('Squad details opening...')">SQUAD</div>
    </nav>

    <script>
        const TEAMS = [
            { id: 'RCB', name: 'RC Bengaluru', color: '#cc1213', logo: 'https://static.iplt20.com/storage/ipl/logos/RCB.png' },
            { id: 'CSK', name: 'Chennai SK', color: '#fdb913', logo: 'https://static.iplt20.com/storage/ipl/logos/CSK.png' },
            { id: 'MI', name: 'Mumbai Indians', color: '#004ba0', logo: 'https://static.iplt20.com/storage/ipl/logos/MI.png' },
            { id: 'KKR', name: 'Kolkata KR', color: '#2e0854', logo: 'https://static.iplt20.com/storage/ipl/logos/KKR.png' },
            { id: 'SRH', name: 'Sunrisers Hyd', color: '#ff6600', logo: 'https://static.iplt20.com/storage/ipl/logos/SRH.png' },
            { id: 'GT', name: 'Gujarat Titans', color: '#1b2133', logo: 'https://static.iplt20.com/storage/ipl/logos/GT.png' },
            { id: 'RR', name: 'Rajasthan Royals', color: '#eb008b', logo: 'https://static.iplt20.com/storage/ipl/logos/RR.png' },
            { id: 'LSG', name: 'Lucknow SG', color: '#0057e2', logo: 'https://static.iplt20.com/storage/ipl/logos/LSG.png' },
            { id: 'DC', name: 'Delhi Capitals', color: '#00008b', logo: 'https://static.iplt20.com/storage/ipl/logos/DC.png' },
            { id: 'PBKS', name: 'Punjab Kings', color: '#dd1f2d', logo: 'https://static.iplt20.com/storage/ipl/logos/PBKS.png' }
        ];

        let gameState = {
            mgr: "",
            userTeam: null,
            day: 1,
            league: [],
            match: null
        };

        // Robust Initialization
        document.addEventListener('DOMContentLoaded', () => {
            const list = document.getElementById('team-selector-list');
            TEAMS.forEach(t => {
                const div = document.createElement('div');
                div.className = 'team-option';
                div.innerHTML = `
                    <img src="${t.logo}" class="team-logo">
                    <div class="team-info">
                        <strong>${t.name}</strong><br>
                        <small style="opacity:0.7">Official Franchise</small>
                    </div>
                `;
                div.onclick = () => selectTeam(t, div);
                list.appendChild(div);
            });
            
            // Setup League Data
            gameState.league = TEAMS.map(t => ({ 
                ...t, p:0, w:0, l:0, runsFor:0, oversFor:0, runsAg:0, oversAg:0, pts:0 
            }));
        });

        function selectTeam(team, element) {
            gameState.userTeam = team;
            document.querySelectorAll('.team-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        function launchGame() {
            gameState.mgr = document.getElementById('mgr-name').value;
            if(!gameState.mgr || !gameState.userTeam) {
                alert("Please enter your name and select a team first!");
                return;
            }

            document.getElementById('dash-mgr').innerText = gameState.mgr;
            document.getElementById('dash-team').innerText = gameState.userTeam.name;
            document.getElementById('dash-logo').src = gameState.userTeam.logo;
            document.getElementById('game-nav').style.display = 'flex';
            
            updateDashboard();
            showScreen('screen-home');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(screenId).classList.add('active-screen');
            
            // Sync Nav
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(screenId === 'screen-league') updateLeagueTable();
        }

        function updateDashboard() {
            const opp = TEAMS.find(t => t.id !== gameState.userTeam.id);
            document.getElementById('next-match-info').innerText = `Match ${gameState.day}: vs ${opp.name}`;
        }

        function updateLeagueTable() {
            const body = document.getElementById('league-body');
            body.innerHTML = "";
            
            // Sort by Pts then NRR
            const sorted = [...gameState.league].sort((a,b) => {
                if(b.pts !== a.pts) return b.pts - a.pts;
                const nrrA = (a.runsFor / (a.oversFor || 1)) - (a.runsAg / (a.oversAg || 1));
                const nrrB = (b.runsFor / (b.oversFor || 1)) - (b.runsAg / (b.oversAg || 1));
                return nrrB - nrrA;
            });

            sorted.forEach((t, i) => {
                const nrr = (t.runsFor / (t.oversFor || 1)) - (t.runsAg / (t.oversAg || 1));
                body.innerHTML += `
                    <tr style="${t.id === gameState.userTeam.id ? 'color:var(--gold);' : ''}">
                        <td style="padding:8px;">${i+1}. ${t.id}</td>
                        <td align="center">${t.p}</td>
                        <td align="center">${t.w}</td>
                        <td align="center">${t.l}</td>
                        <td align="center">${nrr.toFixed(3)}</td>
                        <td align="center"><strong>${t.pts}</strong></td>
                    </tr>
                `;
            });
        }

        // MATCH ENGINE v1.1
        function startMatchDay() {
            showScreen('screen-match');
            gameState.match = { score: 0, wickets: 0, balls: 0, target: 165 };
            document.getElementById('m-team1').innerText = gameState.userTeam.id;
            document.getElementById('m-team2').innerText = "OPPONENT";
            document.getElementById('m-log').innerHTML = "Chasing 165 runs in 20 overs...";
            updateMatchUI();
        }

        function bowlBall(intent) {
            const m = gameState.match;
            let risk = 0.1; // Base chance of wicket
            let runFactor = 1;

            if(intent === 'aggressive') { risk = 0.25; runFactor = 2; }
            if(intent === 'risky') { risk = 0.45; runFactor = 3.5; }

            const rand = Math.random();
            if(rand < risk) {
                m.wickets++;
                log("OUT! Brilliant catch at the boundary.");
            } else {
                const runs = [0,1,2,3,4,6][Math.floor(Math.random() * 6)];
                m.score += runs;
                if(runs > 0) log(`${runs} runs scored!`);
            }

            m.balls++;
            updateMatchUI();

            if(m.score >= m.target) finishMatch(true);
            else if(m.wickets >= 10 || m.balls >= 120) finishMatch(m.score >= m.target);
        }

        function updateMatchUI() {
            const m = gameState.match;
            document.getElementById('m-score').innerText = `${m.score}/${m.wickets}`;
            document.getElementById('m-overs').innerText = `${Math.floor(m.balls/6)}.${m.balls%6} / 20.0 Overs`;
        }

        function log(msg) {
            const l = document.getElementById('m-log');
            l.innerHTML = `<div>${msg}</div>` + l.innerHTML;
        }

        function finishMatch(won) {
            alert(won ? "VICTORY! Match won!" : "Defeat! Better luck next time.");
            
            const user = gameState.league.find(t => t.id === gameState.userTeam.id);
            user.p++;
            if(won) { user.w++; user.pts += 2; } else { user.l++; }
            
            // Simplified NRR Update
            user.runsFor += gameState.match.score;
            user.oversFor += 20;
            user.runsAg += 164;
            user.oversAg += 20;

            gameState.day++;
            showScreen('screen-home');
            updateDashboard();
        }
    </script>
</body>
</html>
